!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=7)}([function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var ParserService=function(){function ParserService(e,t){_classCallCheck(this,ParserService),this.elementCache=t.elementCache,this.collectionCache=t.collectionCache,this.bridgeMapper=e}return _createClass(ParserService,[{key:"analyzeThis",value:function(e,t,i){this.parseBind(e,t,i),this.parseActions(e,t,i),e.getAttribute("data-repeat")?this.parseForeach(e,t,i):this.analyzeNode(e,t,i)}},{key:"analyzeNode",value:function(e,t,i){for(var n=e.children,r=0;r<n.length;r++){var a=n[r];this.analyzeThis(a,t,i)}}},{key:"globalizePath",value:function(e,t){var i=t;for(".."===e.slice(0,2)&&(e=e.slice(2),i=i.slice(0,i.lastIndexOf(".")));"."===e[0];)e=e.slice(1),i=i.slice(0,i.lastIndexOf("."));return i+"."+e}},{key:"createHandler",value:function(e,t){var i=this;return function(n){n.stopImmediatePropagation(),i.bridgeMapper.fireCommand(e,t)}}},{key:"createBindingInfo",value:function(e,t,i,n,r){return{element:e,key:t,insideTemplate:i,converter:n,parameter:r}}},{key:"saveBinding",value:function(e,t){this.elementCache[e]?this.elementCache[e].push(t):this.elementCache[e]=[t]}},{key:"parseActions",value:function parseActions(child,dataContext,insideTemplate){var actionsAttributeValue=child.getAttribute("data-actions");if(actionsAttributeValue){var context=dataContext,bindingDescriptor=eval("("+actionsAttributeValue+")");for(var key in bindingDescriptor)if(bindingDescriptor.hasOwnProperty(key)){var descriptor=bindingDescriptor[key],path=null,parameter=null;"string"==typeof descriptor||descriptor instanceof String?(path=descriptor,parameter=null):(path=descriptor.command,parameter=descriptor.parameter);var binding=this.createBindingInfo(child,key,insideTemplate,null,parameter),overridenDataContext=child.getAttribute("data-context");overridenDataContext&&(dataContext=overridenDataContext);var bindingPath=this.globalizePath(path,dataContext);this.saveBinding(bindingPath,binding);var value=this.createHandler(bindingPath,parameter);child.addEventListener(key,value)}}}},{key:"parseBind",value:function parseBind(child,dataContext,insideTemplate){var bindAttributeValue=child.getAttribute("data-bind");if(bindAttributeValue){var that=this,context=dataContext,bindingDescriptor=eval("("+bindAttributeValue+")");for(var key in bindingDescriptor)if(bindingDescriptor.hasOwnProperty(key)){var descriptor=bindingDescriptor[key],path=null,converter=function(e){return e};"string"==typeof descriptor||descriptor instanceof String?path=descriptor:(path=descriptor.path,converter=descriptor.converter);var binding=this.createBindingInfo(child,key,insideTemplate,converter),overridenDataContext=child.getAttribute("data-context");overridenDataContext&&(dataContext=overridenDataContext);var bindingPath=this.globalizePath(path,dataContext);if(this.saveBinding(bindingPath,binding),"value"===key)if("radio"===child.type){var bpath=bindingPath;child.addEventListener("change",function(){if(child.checked){var e=child.value,t=child.getAttribute("data-selected-bind"),i=t?that.globalizePath(t,bpath):bpath;that.bridgeMapper.propertySet(i,e)}})}else{var bpath=bindingPath;child.addEventListener("input",function(){var e=child.value;that.bridgeMapper.propertySet(bpath,e)})}if("checked"===key&&"checkbox"===child.type){var bpath=bindingPath;child.addEventListener("change",function(){var e=child.checked;that.bridgeMapper.propertySet(bpath,e)})}this.bridgeMapper.registerBinding(bindingPath,insideTemplate)}}}},{key:"parseForeach",value:function(e,t,i){var n=e.getAttribute("data-repeat");if(n){var r=t+"."+n,a=e.children[0];this.collectionCache[r]={rootElement:e,template:a},e.removeChild(a),this.bridgeMapper.registerBinding(r,i)}}}]),ParserService}();__webpack_exports__.a=ParserService},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parserService=t,this.elementCache=i.elementCache}return function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)}(e,[{key:"getNextPath",value:function(e,t,i){var n=t,r=e.length+1,a=n.substring(r),s=a.indexOf("]"),o=n.substr(0,r),c=a.substr(s),l=n.substr(e.length+1,s),h=parseInt(l),d=i(h);return{nextPath:o+d+c,index:h,newIndex:d}}},{key:"renderCollectionItemFromTemplate",value:function(e,t,i,n){var r=this,a=t.cloneNode(!0);if(n<i.children.length){i.insertBefore(a,i.children[n]);var s=Object.keys(this.elementCache).filter(function(t){return 0===t.indexOf(e+"[")}).reduce(function(e,t){return e[t]=r.elementCache[t],e},{}),o={};for(var c in s)if(s.hasOwnProperty(c)){var l=this.getNextPath(e,c,function(e){return e+1});l.index>=n&&(o[l.nextPath]=this.elementCache[c],delete this.elementCache[c])}for(var h in o)o.hasOwnProperty(h)&&(this.elementCache[h]=o[h])}else i.appendChild(a);this.parserService.analyzeThis(a,e+"["+n+"]",!0)}},{key:"renderForeach",value:function(e,t,i,n){for(;n.firstChild;)n.removeChild(n.firstChild);for(var r=0;r<e.length;r++)this.renderCollectionItemFromTemplate(t,i,n,r)}}]),e}();t.a=r},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bridge=t,this.registerBinding=this.registerBinding.bind(this),this.propertySet=this.propertySet.bind(this),this.fireCommand=this.fireCommand.bind(this),this.appReady=this.appReady.bind(this)}return function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)}(e,[{key:"registerBinding",value:function(e,t){t?this.bridge.sendMessage({functionName:"RegisterBindingCollection",params:[e]}):this.bridge.sendMessage({functionName:"RegisterBinding",params:[e,!1]})}},{key:"propertySet",value:function(e,t){this.bridge.sendMessage({functionName:"PropertySet",params:[e,t]})}},{key:"fireCommand",value:function(e,t){var i=t||"";this.bridge.sendMessage({functionName:"FireCommand",params:[e,i]})}},{key:"appReady",value:function(){this.bridge.sendMessage({functionName:"Init",params:[]})}}]),e}();t.a=r},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(t,i,n,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewCache={},this.eventListeners={},this.collectionCache=a.collectionCache,this.elementCache=a.elementCache,this.bridgeMapper=t,this.viewLoaderService=i,this.parserService=n,this.rendererService=r,this.jsbind=this.jsbind.bind(this),this.navigateTo=this.navigateTo.bind(this),this.handleCollectionChange=this.handleCollectionChange.bind(this),this.setValue=this.setValue.bind(this)}return function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)}(e,[{key:"on",value:function(e,t){void 0===this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)}},{key:"jsbind",value:function(){this.frame=document.querySelector("[data-mvvmstart]");for(var e=document.querySelectorAll("[data-view]"),t=0;t<e.length;t++){var i=e[t],n=i.getAttribute("data-view");this.viewCache[n]={element:i,initialized:!1},i.parentElement.removeChild(i)}this.bridgeMapper.appReady()}},{key:"navigateTo",value:function(e){var t=this;if(this.viewCache[e]){var i=this.viewCache[e].element;if(!this.viewCache[e].initialized){var n=i,r=n.getAttribute("data-context");this.parserService.analyzeNode(n,r),this.viewCache[e].initialized=!0}for(;this.frame.firstChild;)this.frame.removeChild(this.frame.firstChild);this.frame.appendChild(i),this.broadcast("ViewChange",{prev:this.currentView,next:e}),this.currentView=e}else this.viewLoaderService.loadView(e,function(i){t.viewCache[e]={element:i,initialized:!1},t.navigateTo(e)})}},{key:"handleCollectionChange",value:function(e,t){var i=this,n=this.collectionCache[e],r=n.rootElement,a=n.template;switch(t.Action){case 0:this.rendererService.renderCollectionItemFromTemplate(e,a,r,t.NewStartingIndex);break;case 4:var s=Object.keys(this.elementCache).filter(function(e){return 0===e.indexOf(n+"[")}).reduce(function(e,t){return e[t]=i.elementCache[t],e},{});for(var o in s)if(s.hasOwnProperty(o))for(var c=s[o],l=0;l<c.length;l++){c[l].insideTemplate&&delete this.elementCache[o]}}}},{key:"setValue",value:function(e,t){var i=this,n=this.elementCache[e];if(n)for(var r=0;r<n.length;r++){var a=n[r],s=a.key,o=a.element;switch(s){case"mvvmvisible":o.style.display=a.converter(t);break;case"mvvmbgcolor":o.style.backgroundColor=a.converter(t);break;case"mvvmbgimage":o.style.backgroundImage=a.converter(t);break;case"mvvmsubview":o[s]?o[s]!==t&&this.broadcast("SubviewChange",{el:o,oldVal:o[s],newVal:t}):this.broadcast("SubviewChange",{el:o,oldVal:null,newVal:t}),o[s]=t;break;default:o[s]=a.converter(t)}}var c=this.collectionCache[e];if(c){var l=c.template;this.rendererService.renderForeach(t,e,l,c.rootElement)}var h=Object.keys(this.elementCache).filter(function(t){return 0===t.indexOf(e+".")}).reduce(function(e,t){return e[t]=i.elementCache[t],e},{});if(h)for(var d in h)if(h.hasOwnProperty(d)){var u=d;this.bridgeMapper.registerBinding(u,!1)}}},{key:"broadcast",value:function(e,t){for(var i in this.eventListeners)if(i===e){for(var n=0;n<this.eventListeners[i].length;n++)this.eventListeners[i][n](t);break}}}]),e}();t.a=r},,,,function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)}(e,[{key:"loadView",value:function(e,t){var i=new ActiveXObject("Msxml2.XMLHTTP");i.open("GET","Views/"+e+".html",!0),i.onreadystatechange=function(){if(4!==i.readyState)return null;var e=document.createElement("div");e.innerHTML=i.responseText;var n=e.getElementsByTagName("div")[0];return t(n),null},i.send()}}]),e}());function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=this.start.bind(this),this.receiveMessage=this.receiveMessage.bind(this),this.sendMessage=this.sendMessage.bind(this),window.receiveMessage=this.receiveMessage}return function(e,t,i){t&&a(e.prototype,t),i&&a(e,i)}(e,[{key:"start",value:function(e){this.service=e,this.service.jsbind()}},{key:"receiveMessage",value:function(e,t){var i=JSON.parse(t);this.service[i.FunctionName].apply(this,i.Params)}},{key:"sendMessage",value:function(e){window.external.notify(JSON.stringify(e))}}]),e}()),o=i(0),c=i(1),l=i(2),h=i(3),d={elementCache:{},collectionCache:{}},u=new l.a(s),f=new o.a(u,d),v=new c.a(f,d),p=new h.a(u,r,f,v,d);s.start(p)}]);